<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>code-blox: js</title>
<style>
  body{background:#000;color:#fff;margin:0;padding:16px;font-family:monospace}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:1400px;margin:auto;}
  @media(max-width:960px){.grid{grid-template-columns:1fr;}}
  .panel{background:#000;border:3px solid rgba(250,204,21,.3);border-radius:16px;padding:20px;}
  .panel h2{margin:0 0 16px;color:#facc15;font-size:22px;font-weight:300;border-bottom:2px solid #facc15;padding-bottom:12px;}
  textarea{width:100%;height:340px;background:rgba(0,0,0,.4);border:2px solid #facc15;border-radius:12px;color:#fff;padding:14px;font:13.5px ui-monospace,monospace;resize:vertical;outline:none;box-sizing:border-box}
  textarea:focus{border-color:#facc15;box-shadow:0 0 10px rgba(250,204,21,.5)}
  button{padding:10px 18px;margin:5px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;font-family:monospace;transition:all .2s}
  button.primary{background:#facc15;color:#000;box-shadow:0 4px 20px rgba(250,204,21,.5)}
  button.primary:hover{transform:scale(1.05);box-shadow:0 6px 30px rgba(250,204,21,.7)}
  button.success{background:#22c55e;color:#000;box-shadow:0 4px 20px rgba(34,197,94,.5)}
  button.success:hover{transform:scale(1.05);box-shadow:0 6px 30px rgba(34,197,94,.7)}
  button.danger{background:#ef4444;color:#fff;box-shadow:0 4px 20px rgba(239,68,68,.5)}
  button.danger:hover{transform:scale(1.05);box-shadow:0 6px 30px rgba(239,68,68,.7)}
  button.small{font-size:11px;padding:6px 10px;}
  .blocks{max-height:760px;overflow:auto;display:flex;flex-direction:column;gap:14px;}
  .block{background:rgba(250,204,21,.1);border:2px solid rgba(250,204,21,.5);border-radius:12px;padding:16px;position:relative;}
  .name{font-size:16px;font-weight:800;margin-bottom:6px;cursor:text;color:#facc15;}
  .meta{font-size:13px;color:#94a3b8;margin:6px 0;}
  .lines{font-weight:bold;color:#facc15;}
  .builder-block{border-left:5px solid #22c55e;background:rgba(34,197,94,.2);}
  .builder-block .name{color:#22c55e}
  .builder-block pre{background:#000;border:2px solid #22c55e;padding:12px;border-radius:8px;overflow-x:auto;font-size:12px;line-height:1.4;margin-top:10px;color:#fff}
  #output{background:#000;padding:16px;border-radius:12px;border:2px solid #facc15;font-size:13px;max-height:560px;overflow:auto;white-space:pre;color:#fff;}
  .modal{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:9999;padding:20px;overflow:auto;display:none;}
  .modal h2{color:#facc15;border-bottom:2px solid #facc15;padding-bottom:12px}
  .modal input{width:100%;padding:10px;font-size:16px;margin-bottom:10px;background:rgba(0,0,0,.4);color:#fff;border:2px solid #facc15;border-radius:8px;outline:none;box-sizing:border-box}
  .modal input:focus{box-shadow:0 0 10px rgba(250,204,21,.5)}
  .modal textarea{height:70vh;font-size:14px;}
</style>
</head>
<body>

<div class="grid">
  <div class="panel">
    <h2>Paste Your JS</h2>
    <textarea id="input" placeholder="// Paste the whole .js file here"></textarea>
    <div style="margin:16px 0;">
      <button class="primary" onclick="extract()">Extract Blocks</button>
      <button class="success" onclick="rebuildOriginal()">Rebuild Original</button>
      <button class="danger" onclick="location.reload()">Clear All</button>
    </div>

    <h2>Extracted Blocks</h2>
    <div id="blocks" class="blocks"></div>
  </div>

  <div class="panel">
    <h2>Builder</h2>
    <button class="danger" onclick="builder=[];update()">Clear Builder</button>
    <div id="builder" class="blocks" style="margin-top:12px;"></div>

    <h2 style="margin-top:20px;">Final Output</h2>
    <button class="primary" onclick="copy()">Copy</button>
    <button onclick="download()">Download .js</button>
    <pre id="output"></pre>
  </div>
</div>

<div id="editorModal" class="modal">
  <h2>Edit Block</h2>
  <input type="text" id="editName" style="width:100%;padding:10px;font-size:16px;margin-bottom:10px;background:#000;color:#fff;border:1px solid #333;">
  <textarea id="editCode"></textarea>
  <div style="margin-top:12px;">
    <button class="success" onclick="saveEdit()">Save</button>
    <button class="danger" onclick="closeEditor()">Cancel</button>
  </div>
</div>

<script>
let originalBlocks = [];
let builder = [];
let editingIndex = -1;

function extract(){
  const code = document.getElementById('input').value.trim();
  if(!code) return alert("Paste code first");

  originalBlocks = [];
  const lines = code.split('\n');
  let current = [], brace = 0, paren = 0;

  const finishBlock = () => {
    if(current.length === 0) return;
    const content = current.join('\n');
    if(!content.trim()) return;

    const nameMatch =
      content.match(/(function|const|let|var|class)\s+([A-Za-z_$][A-Za-z0-9_$]*)|([A-Za-z_$][A-Za-z0-9_$]*)\s*=/) || [];
    const name = nameMatch[2] || nameMatch[3] || "anonymous";

    originalBlocks.push({
      id: 'b' + Date.now() + Math.random(),
      name: name,
      content: content,
      lines: content.split('\n').length
    });
    current = [];
  };

  for(let line of lines){
    current.push(line);
    for(let ch of line){
      if(ch==='{') brace++;
      if(ch==='}') brace--;
      if(ch==='(') paren++;
      if(ch===')') paren--;
    }
    if(brace === 0 && paren <= 0 && current.length > 1) finishBlock();
  }
  finishBlock();

  if(originalBlocks.length === 0){
    originalBlocks.push({id:'full',name:'Full Script',content:code,lines:code.split('\n').length});
  }

  renderBlocks();
}

function renderBlocks(){
  document.getElementById('blocks').innerHTML = originalBlocks.map((b, i) => `
    <div class="block">
      <div class="name" contenteditable="true"
           onblur="originalBlocks[${i}].name=this.textContent.trim()||'anonymous'">
        ${b.name}
      </div>
      <div class="meta">
        <span class="lines">${b.lines} lines</span>
        <button class="small" onclick="editBlock(${i})">Edit Code</button>
        <button class="small" onclick="extractThis('${b.id}')">Add to Builder</button>
      </div>
    </div>
  `).join('');
}

function editBlock(i){
  editingIndex = i;
  const block = originalBlocks[i];
  document.getElementById('editName').value = block.name;
  document.getElementById('editCode').value = block.content;
  document.getElementById('editorModal').style.display = 'block';
}

function saveEdit(){
  if(editingIndex === -1) return;
  const block = originalBlocks[editingIndex];
  block.name = document.getElementById('editName').value.trim() || "anonymous";
  block.content = document.getElementById('editCode').value;
  block.lines = block.content.split('\n').length;
  closeEditor();
  renderBlocks();
  update();
}

function closeEditor(){
  document.getElementById('editorModal').style.display = 'none';
  editingIndex = -1;
}

function extractThis(id){
  const block = originalBlocks.find(b => b.id === id);
  if(block && !builder.find(b => b.id === id)){
    builder.push({...block});
    update();
  }
}

function update(){
  document.getElementById('builder').innerHTML = builder.map((b, i) => `
    <div class="block builder-block">
      <div class="name">${b.name}</div>
      <div class="meta">
        <span class="lines">${b.lines} lines</span>
        <button class="danger small" onclick="builder.splice(${i},1);update()">Remove</button>
      </div>
      <pre>${b.content.trim()}</pre>
    </div>
  `).join('') || '<div style="color:#666;padding:20px;">No blocks in builder yet</div>';

  document.getElementById('output').textContent =
    builder.map(b => b.content.trim()).join('\n\n') + (builder.length ? '\n' : '');
}

function rebuildOriginal(){
  builder = originalBlocks.map(b => ({...b}));
  update();
}

function copy(){
  navigator.clipboard.writeText(document.getElementById('output').textContent);
  alert("Copied!");
}

function download(){
  const blob = new Blob([document.getElementById('output').textContent], {type:'application/javascript'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'cleaned.js';
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>