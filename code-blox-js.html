<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>code-blox: js (AST-based)</title>

<!-- Acorn parser for robust AST extraction -->
<script src="https://unpkg.com/acorn@8.8.2/dist/acorn.min.js"></script>
<script src="https://unpkg.com/acorn-walk@8.2.0/dist/walk.min.js"></script>

<style>
  /* MOBILE-FIRST APPROACH */
  :root 0.5);
    --panel: #000;
    --text: #fff;
    --muted: #94a3b8;
  }
  
  * {
    box-sizing: border-box;
  }
  
  body {
    background: #000;
    color: var(--text);
    margin: 0;
    padding: 12px;;
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* GRID - MOBILE FIRST */
  .grid {
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 100%;
    margin: auto;
  }
  
  /* TABLET */
  @media (min-width: 768px) {
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    body {
      padding: 16px;
    }
  }
  
  /* DESKTOP */
  @media (min-width: 1024px) {
    .grid {
      max-width: 1400px;
    }
  }
  
  /* PANELS */
  .panel {
    background: var(--panel);
    border: 2px solid rgba(250, for mobile */
    border-radius: 12px; /* Smaller radius */
    padding: 16px; /* Reduced padding */
    min-height: auto;
  }
  
  .panel h2 {
    margin: 0 0 12px;
    color: var(--neon);
    font-size: 18px; /* Smaller on mobile */
    font-weight: 600;
    border-bottom: 1px solid var(--neon);
    padding-bottom: 8px;
    word-break: break-word;
  }
  
  /* TEXTAREA - MOBILE OPTIMIZED */
  textarea {
    width: 100%;
    height: 200px; /* Shorter on mobile */
    background: rgba(0, 0, 0, 0.4);
    border: 1px solid var(--neon);
    border-radius: 8px;
    color: var(--text);
    padding: 12px;
    font: 14px -apple-system, system-ui, monospace;
    resize: vertical;
    outline: none;
    box-sizing: border-box;
    -webkit-appearance: none;
    font-size: 14px; /* Bigger for mobile typing */
    line-height: 1.4;
  }
  
  @media (min-width: 768px) {
    textarea {
      height: 340px;
      font-size: 13.5px;
      padding: 14px;
    }
  }
  
  textarea:focus {
    border-width: 2px;
    box-shadow: 0 0 8px rgba(250, 204, 21, 0.5);
  }
  
  /* BUTTONS - TOUCH-FRIENDLY */
  button {
    padding: 12px 16px; /* Bigger for touch */
    margin: 4px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    font-family: -apple-system, system-ui, sans-serif;
    transition: all 0.2s;
    font-size: 14px;
    min-height: 44px; /* Minimum touch target size */
    min-width: 44px;
  }
  
  /* BUTTON ROWS - STACK ON MOBILE */
  .btn-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin: 12px 0;
  }
  
  button.primary {
    background: var(--neon);
    color: #000;
    box-shadow: 0 2px 8px rgba(250, 204, 21, 0.5);
    flex: 1;
    min-width: 120px;
  }
  
  button.primary:hover, button.primary:active {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(250, 204, 21, 0.7);
  }
  
  button.success {
    background: #22c55e;
    color: #000;
    box-shadow: 0 2px 8px rgba(34, 197, 94, 0.5);
    flex: 1;
    min-width: 120px;
  }
  
  button.danger {
    background: #ef4444;
    color: #fff;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.5);
    flex: 1;
    min-width: 120px;
  }
  
  button.small {
    font-size: 12px;
    padding: 8px 12px;
    min-height: 36px;
    min-width: 60px;
  }
  
  /* BLOCKS CONTAINER - SCROLLABLE column;
    gap: 12px;
    -webkit-overflow-scrolling: touch; /* Smooth iOS scroll */
  }
  
  @media (min-width: 768px) {
    .blocks {
      max-height: 760px;
      gap: 14px;
    }
  }
  
  /* INDIVIDUAL BLOCKS250, 204, 21, 0.12);
    border-radius: 8px;
    padding: 12px;
    position: relative;
    word-break: break-word;
  }
  
  .name {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 4px;
    cursor: text;
    color: var(--neon);
    line-height: 1.3;
    outline: none;
  }
  
  .meta {
    font-size: 12px;
    color: var(--muted);
    margin: 6px 0;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
  }
  
  .lines {
    font-weight: bold;
    color: var(--neon);
  }
  
  .builder-block {
    border-left: 4px solid #22c55e;
    background: rgba(34, 197, 94, 0.06);
  }
  
  .builder-block .name {
    color: #22c55e;
  }
  
  .builder-block pre {
    background: #000;
    border: 1px solid #22c55e;
    padding: 10px;
    border-radius: 6px;
    overflow-x: auto;
    font-size: 11px;
    line-height: 1.3;
    margin-top: 8px;
    color: #fff;
    -webkit-overflow-scrolling: touch;
  }
  
  /* OUTPUT AREA */
  #output {
    background: #000;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--neon);
    font-size: 12px;
    max-height: 300px; /* Smaller on mobile */
    overflow: auto;
    white-space: pre;
    color: #fff;
    -webkit-overflow-scrolling: touch;
  }
  
  @media (min-width: 768px) {
    #output {
      max-height: 560px;
      padding: 16px;
      font-size: 13px;
    }
  }
  
  /* MODAL - FULLSCREEN ON MOBILE */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 9999;
    padding: 16px;
    overflow: auto;
    display: none;
    -webkit-overflow-scrolling: touch;
  }
  
  .modal h2 {
    color: var(--neon);
    border-bottom: 1px solid var(--neon);
    padding-bottom: 8px;
    font-size: 18px;
    margin-top: 0;
  }
  
  .modal input {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin-bottom: 12px;
    background: rgba(0, 0, 0, 0.4);
    color: #fff;
    border: 1px solid var(--neon);
    border-radius: 8px;
    outline: none;
    box-sizing: border(250, 204, 21, 0.5);
  }
  
  .modal textarea {
    height: calc(100vh - 200px); /* Dynamic height */
    font-size: 14px;
    margin-bottom: 12px;
  }
  
  /* UTILITY CLASSES FOR MOBILE */
  .mobile-only {
    display: block;
  }
  
  .    .mobile-only {
      display: none;
    }
    .desktop-only {
      display: block;
    }
  }
  
  /* SWIPE HINTS (FOR MOBILE UX) */
  .swipe-hint {
    display: none;
    text-align: center;
    font-size: 12px;
    color: var(--muted);
    padding: 8px;
    margin-top: 8px;
  }
  
  @media (max-width: 767px) {
    .swipe-hint {
      display: block;
    }
  }
  
  /* TOUCH-OPTIMIZED SCROLLBARS */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  
  ::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: var(--neon);
    border-radius: 4px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: rgba(250, 204, 21, 0.8);
  }
  
  /* PREVENT TEXT SELECTION ON BUTTONS */
  button {
    user-select: none;
    -webkit-user-select: none;
  }
  
  /* IMPROVE READABILITY ON SMALL SCREENS */
  @media (max-width: 767px) {
    .block pre      font-size: 10px;
      padding: 8px;
    }
    
    .meta button {
      margin: 2px;
    }
  }

  /* Toast styling (added in CSS so no runtime injection needed) */
  .toast {
    position: fixed;
    bottom: 20px;
 border-radius: 8px;
    font-weight: bold;
    z-index: 10000;
    animation: fadeInOut 2s ease-in-out;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  @keyframes fadeInOut {
    0% { opacity: 0; bottom: 0; }
    10% { opacity: 1; bottom: 20px; }
    90% { opacity: 1; bottom: 20px; }
    100% { opacity: 0; bottom: 40px; }
  }
</style>
</head>
<body>

<div class="grid">
  <!-- LEFT PANEL - INPUT -->
  <div class="panel">
    <h2>Paste Your JS</h2>
    <textarea id="input" placeholder="// Paste JS code here
// Or use the example below

function hello(name) {
  console.log('Hello ' + name);
  return name.length;
}

const calculate = (a, b) => {
  return a * b + 100;
};

class User {
  constructor(name) {
    this.name = name;
  }
  
  greet() {
    return `Hello ${this.name}`;
  }
}"></textarea>
    
    <div class="btn-row">
      <button class="primary" onclick="extract()">Extract Blocks</button>
      <button class="success" onclick="rebuildOriginal()">Rebuild</button>
      <button class="danger" onclick="location.reload()">Clear All</button>
    </div>
    
    <div class="mobile-only">
      <button class="small" onclick="pasteFromClipboard()">üìã Paste</button>
      <button class="small" onclick="loadExample()">üìñ Example</button>
üëÜ Tap to edit names, swipe to scroll</div>
    <div id="blocks" class="blocks"></div>
  </div>

  <!-- RIGHT PANEL - BUILDER -->
  <div class="panel">
    <h2>Builder</h2>
    <div class="btn-row">
      <button class="danger" onclick="builder=[];update()">Clear Builder</button>
      <button class="small mobile-only" onclick="toggleBuilderView()">üì± View</button>
    </div>
    
    <div class="swipe-hint">üëÜ Drag blocks from left, tap to reorder</div>
    <div id="builder" class="blocks" style="margin-top:8px;"></div>

    <h2 style="margin-top:20px;">Final Output</h2>
    <div class="btn-row">
="download()">üì• Download .js</button>
      <button class="small mobile-only" onclick="shareOutput()">üì§ Share</button>
    </div>
    
    <pre id="output"></pre>
  </div>
</div>

<!-- EDIT MODAL -->
<div id="editorModal" class="modal">
  <h2>Edit Block</h2>
  <input type="text" id="editName" placeholder="Block name (e.g., calculateUser)">
  <textarea id="editCode" placeholder="Edit your JavaScript code here..."></textarea>
  <div style="margin-top:12px; display: flex; gap: 8px;">
    <button class="success" onclick="saveEdit()" style="flex:1;">üíæ Save</button>
    <button class="danger" onclick="closeEditor()" style="flex:1;">‚ùå Cancel</button>
  </div>
</div>

<!-- MOBILE KEYBOARD HINT -->
<div id="keyboardHint" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#111; color:#facc15; padding:10px; text-align:center; font-size:12px;">
  Tap here to close keyboard üëÜ
</div>

<script>
/* GitHub Copilot Chat Assistant - AST-based extraction and UI
   Complete, copylet editingIndex = -1;
let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// Initialize UI enhancements (mobile friendly)
document.addEventListener('DOMContentLoaded', function() {
  // focus styling for.querySelectorAll('textarea');
    textareas.forEach(textarea => {
      textarea.addEventListener('focus', function() {
        document.getElementById('keyboardHint').style.display = 'block';
      });
      textarea.addEventListener('blur', function() {
        document.getElementById('keyboardHint').style.display = 'none';
      });
    });
    document.getElementById('keyboardHint').addEventListener('click', function() {
      if (document.activeElement) document.activeElement.blur();
      this.style.display = 'none';
    });
  }

  // Load example once per first visit
  if (!localStorage.getItem('codeblox_visited')) {
    localStorage.setItem('codeblox_visited', 'true');
    setTimeout(loadExample, 500);
  }
});

// TOAST
function showToast(message) {
  const existing = document.querySelector('.toast');
  if (existing) existing.remove();
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = message;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}

// MOBILE-ONLY FUNCTIONS
function pasteFromClipboard() {
  if (!navigator.clipboard) {
    alert("Clipboard notToast("‚úÖ Pasted from clipboard");
  }).catch(err => {
    alert("Could not paste. Try manual paste instead.");
  });
}

function loadExample() {
  const example = `// Example JavaScript with multiple blocks
function calculateTotal(items) {
  return items.reduce((sum, item) => sum + item.price, 0);
}

const user = {
  name: "Alex",
${this.name}\`;
  }
};

class Product {
  constructor(name, price) {
    this.name = name;
    this.price = price;
  }
  
  applyDiscount(percent) {
    this.price = this.price * (1 - percent/100);
    return this.price;
  }
}

// Arrow function example
const formatCurrency = (amount) => \`$\${amount.toFixed(2)}\`;

// Utility function
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}`;
  document.getElementById('input').value = example;
  showToast("üìñ Example loaded");
}

function shareOutput() {
  const output = document.getElementBy to share");
    return;
  }
  if (navigator.share) {
    navigator.share({
      title: 'code-blox Output',
      text: output.substring(0, 100) + '...',
      url: window.location.href
    });
  } else {
    copy();
  }
}

function toggleBuilderView builder = document.getElementById('builder');
  const isCollapsed = builderEl.style.maxHeight === '200px';
  if (isCollapsed) {
    builderEl.style.maxHeight = '400px';
    builderEl.style.overflow = 'auto';
  } else {
    builderEl.style.maxHeight = '200px';
    builderEl.style.overflow = 'hidden';
  }
}

// HTML escaping helper
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// AST helper to slice original source exactly
function sliceSource(src, start, end) {
  return src.slice(start, end);
}

/* AST-BASED EXTRACTION
   Uses acorn (loaded via CDN) to parse top-level program nodes and preserve exact source slices.
*/
function extract() {
  const code = document.getElementById('input').value;
  if (!code || !code.trim()) {
    showToast("‚ùå Paste code first");
    return;
  }

  originalBlocks = [];

  try {
    const comments = [];
    const ast = acorn.parse(code, {
      ecmaVersion: "latest",
      sourceType: "module",
      ranges: true,
      onComment: comments
    });

    for (const node of ast.body) {
      // unwrap export declarations to the inner declaration if present
      let realNode = node;
      let nodeType = node.type;
      if (node.type === "ExportNamedDeclaration" || node.type === "ExportDefaultDeclaration") {
        if (node.declaration) {
          realNode = node.declaration;
          nodeType = realNode.type;
        } else {
          // export { x, y } from ...
          originalBlocks.push({
            id: 'b' + Date.now() + Math.random(),
            name: "export",
            type: "export",
            content: sliceSource(code, node.start, node.end),
            start: node.start,
            end: node.end,
            lines: sliceSource(code, node.start, node.end).split('\n').length
          });
          continue;
        }
      }

      // FunctionDeclaration
      if (nodeType === "FunctionDeclaration") {
        const name = (realNode.id && realNode.id.name) ? realNode.id.name : "anonymous";
        originalBlocks.push({
          id: 'b' + Date.now() + Math.random(),
          name,
          type: "function",
          content: sliceSource(code, node.start, node.end),
          start: node.start,
          end: node.end,
          lines: sliceSource(code, node.start, node.end).split('\n').length
        });
        continue;
      }

      // ClassDeclaration
      if (nodeType === "ClassDeclaration") {
        const name = (realNode.id && realNode.id.name) ? realNode.id.name : "AnonymousClass";
        originalBlocks.push({
          id: 'b' + Date.now() + Math.random(),
          name,
          type: "class",
          content: sliceSource(code, node.start, node.end),
          start: node.start,
          end: node.end,
          lines: sliceSource(code, node.start, node.end).split('\n').length
        });
        continue;
      }

      // VariableDeclaration ‚Äî split into variable declarators (const a = () => {} ; const b = 1;)
      if (nodeType === "VariableDeclaration") {
        for (const d of realNode.declarations) {
          const init = d.init;
          const name = (d.id && d.id.name) ? d.id.name : "var";
          if (!init) {
            originalBlocks.push({
              id: 'b' + Date.now() + Math.random(),
              name,
              type: "variable",
              content: sliceSource(code, d.start, d.end),
              start: d.start,
              end: d.end,
              lines: sliceSource(code, d.start, d.end).split('\n').length
            });
            continue;
          }

          if (init.type === "FunctionExpression" || init.type === "ArrowFunctionExpression") {
            originalBlocks.push({
              id: 'b' + Date.now() + Math.random(),
              name,
              type: "function",
              content: sliceSource(code, d.start, d.end),
              start: d.start,
              end: d.end,
              lines: slice {
            originalBlocks.push({
              id: 'b' + Date.now() + Math.random(),
              name,
              type: "variable",
              content: sliceSource(code, d.start, d.end),
              start: d.start,
              end: d.end,
              lines: sliceSource(code, d.start, d.end).split('\n').length
            });
          }
        }
        continue;
      }

      // ImportDeclaration        originalBlocks.push({
          id: 'b' + Date.now() + Math.random(),
          name: "import",
          type: "import",
          content: sliceSource(code, node.start, node.end),
          start: node.start,
          end: node.end,
          lines: sliceSource(code, node.startBlocks.push({
        id: 'b' + Date.now() + Math.random(),
        name: nodeType,
        type: "other",
        content: sliceSource(code, node.start, node.end),
        start: node.start,
        end: node.end,
        lines: sliceSource(code, node.start, node.end).split('\n').length
      });
    }

    if (originalBlocks.length === 0) {
      // fallback: full file
      originalBlocks.push({
        id: 'full',
        name: 'Full Script',
        type: 'full',
        content: code,
        start: 0,
        end: code.length,
        lines: code.split('\n').length
      });
    }

    // Preserve original order
    originalBlocks.sort((a, b) => (a.start || 0) - (b.start || 0));

    renderBlocks();
    showToast(`‚úÖ Extracted ${originalBlocks.length} blocks`);
  } catch (err) {
    console.error(err);
    showToast("‚ùå Parse error ‚Äî check syntax or try simpler input");
  }
}

// Render extracted blocks on the left panel
function renderBlocks(){
  const blocksContainer = document.getElementById('blocks');
  if (!blocksContainer) return;
  blocksContainer.innerHTML = originalBlocks.map((b, i) => {
    const safeName = escapeHtml(b.name);
    const typeLabel = escapeHtml(b.type || 'other');
    return `
      <div class="block" data-id="${b.id}">
        <div class="name" contenteditable="true"
             onblur="originalBlocks[${i}].name=this.textContent.trim()||'${safeName.replace(/'/g,"\\'")}'">
          ${safeName}
        </div>
        <div class="meta">
          <span class="lines">${b.lines} lines</span>
          <span style="color:#94a3b8;margin-left:8px;">${typeLabel}</span>
          <button class="small" onclick="editBlock(${i})">‚úèÔ∏è Edit</button>
          <button class="small" onclick="extractThis('${b.id}')">‚ûï Add</button>
        </div>
      </div>
    `;
  }).join('');
}

// Edit block modal
function editBlock(i){
  editingIndex = i;
  const block = originalBlocks[i];
  document.getElementById('editName').value = block.name;
  document.getElementById('editCode').value = block.content;
  document.getElementById('editorModal').style.display = 'block';

  if (isMobile) {
    setTimeout(() => {
      document.getElementById('editCode').focus();
    }, 100);
  }
}

function saveEdit(){
  if (editingIndex === -1) return;
  const block = originalBlocks[editingIndex];
  block.name = document.getElementById('editName').value.trim() || "anonymous";
  block.content = document.getElementById('editCode').value;
  block.lines = block.content.split('\n').length;
  closeEditor();
  renderBlocks();
  update();
  showToast("üíæ Changes saved");
}

function closeEditor(){
  document.getElementById('editorModal').style.display = 'none';
  editingIndex = -1;
  if (document.activeElement) document.activeElement.blur();
}

// Add a block to builder by id (keeps copy)
function extractThis(id){
  const block = originalBlocks.find(b => b.id === id);
  if (block && !builder.find(b => b.id === id)) {
    builder.push({...block});
    update();
    showToast("‚úÖ Added to builder");
  } else {
    showToast("‚ÑπÔ∏è Already in builder");
  }
}

// Update builder UI & output area
function update(){
  const builderContainer = document.getElementById('builder');
  const outputContainer = document.getElementById('output');
  if (!builderContainer || !outputContainer) return;

  builderContainer.innerHTML = builder.map((b, i) => `
    <div class="block builder-block" data-id="${b.id}">
      <div class="name">${escapeHtml(b.name)}</div>
      <div class=" onclick="builder.splice(${i},1);update();showToast('üóëÔ∏è Removed')">Remove</button>
      </div>
      <pre>${escapeHtml(b.content.trim())}</pre>
    </div>
  `).join('') || '<div style="color:#666;padding:20px;text-align:center;">No blocks in builder yet</div>';

  // Output is exact concatenation of block contents in current b.content).join('\n\n') + (builder.length ? '\n' : '');
}

// Rebuild builder with the original AST-preserved order
function rebuildOriginal(){
  builder = originalBlocks.map(b => ({...b}));
  update();
  showToast("üîÑ Original rebuilt (AST-preserved order)");
}

// Copy output to clipboard
function copy(){
  const text = document.get");
    return;
  }
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => {
      showToast("üìã Copied to clipboard!");
    }).catch(() => fallbackCopy(text));
  } else {
    fallbackCopy(text);
  }

  function fallback.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast("üìã Copied!");
  }
}

// Download output as .js
function download(){
  const text = document.getElementById('output').textContent;
  if (!text.trim()) {
    showToast("‚ùå Nothing to download");
    return;
  }
  const blob = new Blob([text], {type:'application/javascript'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'code-blox-output.js';
  a.click();
  URL.revokeObjectURL(url);
  showToast("üì• Download started");
}

// Close modal when clicking outside (mobile-friendly)
document.getElementById('editorModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeEditor();
  }
});

// Prevent accidental page reload
window.addEventListener('beforeunload', function(e) {
  if (builder.length > 0 || document.getElementById('input').value.trim()) {
    e.preventDefault();
    e.returnValue = '';
  }
});
</script>
</body>
</html>